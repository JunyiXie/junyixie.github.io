<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>2021 技术上的一些总结 | xiejunyi blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="2021是我开启新挑战的一年, 这一年我最大的工作是给 CPython 编写 ARM64 下的 baseline JIT compiler. 简单说一下我的感受 在2021年 CPython还没有支持ARM64的ba">
    <meta name="generator" content="Hugo 0.110.0">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    
    
    
      

    

    
    
    <meta property="og:title" content="2021 技术上的一些总结" />
<meta property="og:description" content="2021是我开启新挑战的一年, 这一年我最大的工作是给 CPython 编写 ARM64 下的 baseline JIT compiler. 简单说一下我的感受 在2021年 CPython还没有支持ARM64的ba" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/post/2021/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-01T15:43:48+08:00" />
<meta property="article:modified_time" content="2023-01-01T14:43:48+08:00" />
<meta itemprop="name" content="2021 技术上的一些总结">
<meta itemprop="description" content="2021是我开启新挑战的一年, 这一年我最大的工作是给 CPython 编写 ARM64 下的 baseline JIT compiler. 简单说一下我的感受 在2021年 CPython还没有支持ARM64的ba"><meta itemprop="datePublished" content="2022-01-01T15:43:48+08:00" />
<meta itemprop="dateModified" content="2023-01-01T14:43:48+08:00" />
<meta itemprop="wordCount" content="3919">
<meta itemprop="keywords" content="年度总结,interpreter,optimization,performance," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="2021 技术上的一些总结"/>
<meta name="twitter:description" content="2021是我开启新挑战的一年, 这一年我最大的工作是给 CPython 编写 ARM64 下的 baseline JIT compiler. 简单说一下我的感受 在2021年 CPython还没有支持ARM64的ba"/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        xiejunyi blog
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/" title="This is Home page">
              This is Home
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/post/" title="Archives page">
              Archives
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/tags/" title="Tags page">
              Tags
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/categories/" title="Categories page">
              Categories
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About page">
              About
            </a>
          </li>
          
        </ul>
      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">2021 技术上的一些总结</h1>
      
      <p class="tracked">
        By <strong>xiejunyi</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2022-01-01T15:43:48+08:00">January 1, 2022</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>2021是我开启新挑战的一年, 这一年我最大的工作是给 CPython 编写 ARM64 下的 baseline JIT compiler.</p>
<p>简单说一下我的感受</p>
<p>在2021年 CPython还没有支持ARM64的baselineJIT编译器, 开始做的时候很盲目, 我缺乏JIT编译器相关的开发经验, 也缺乏好的参考资料. 就先按照自己的思路编写, 同时摸着pyston过河&hellip;疯狂coding了3个月吧&hellip; 这算是极大的锻炼了我的耐心和意志&hellip; 编写baseline JIT 并且支持所有CPython features是一个折磨人的过程&hellip;, 这段时间我感觉自己精神扭曲, 全部精力都在研究为什么我的baseline JIT在ARM64下的优化效果比pyston差&hellip; 在这个过程中 算是吸收了pyston项目的绝大多数的优化技术&hellip;</p>
<p>在我用人工能力写 Assembler Codegen 的过程中, 一点点分析怎么处理寄存器,排列汇编代码,处理代码冷热,优化局部性,分析Pythonfeatures添加Inline Caches, 深刻理解了CPU MemoryCaches对性能的影响, 呵呵&hellip;. 最终, 我的baseline JIT在简单场景的,容器,binaryOP,func call, 操作中, 可以优化50%+, 复杂场景, 可以优化20%+.</p>
<p>回忆这段经历,这是我最具有创造性的一段时间&hellip; 由于缺乏对JIT编译器的了解, 在编写Baseline-JIT的时候, 我设计的一些方案, 现在看还是有启发性的&hellip;先进的&hellip;, 但是由于要打工吃饭, 还是选择了最靠谱最快的实现方式, 参考的Pyston x86_64 baselineJIT&hellip;</p>
<p>现在简要说一下我当时设计的方案, 如何快速的创建高性能的Baseline-JIT, 且具备可复用性, 为其他编程语言的解释器快速创建baselineJIT.</p>
<p>我们在编写baselineJIT的时候,大部分时间的工作是在将原有解释器的实现 用assembler写伪汇编代码.
这个过程是很重复的在做C编译器的工作. 不同点是, 编译器例如clang会按照arm64调用约定自动分配寄存器, 而baselineJIT内部为了高效往往会把特定的数据固定到特定的寄存器上, 这也是一套规则.
恰巧这个规则在clang可以自己定义, 也就是说 我们可以通过定义规则让clang按照我们baselineJIT的寄存器分配规则进行代码生成, 这就解决了工作量最大的部分&hellip;</p>
<p>至于当时没采取这种方案, 还是因为现实, 在公司打工, 要在一定的期限内拿到结果&hellip; 创新性的具备创意的方案 存在太多的不确定性&hellip; 我倾向于参考已有的实现, 已有的知识变成了创新的包袱.</p>
<p>在编写baselineJIT的时候, 我尝试去读cinder和pyston的源码, 读源码可能是最垃圾最浪费时间的事情. NB的项目往往核心的原理只占1%, 其余99%都是无意义的重复&hellip; 人生建议, 找到作者, 直接去问, 你到底编写这写代码的核心思路是什么, 做过哪些优化&hellip;</p>
<p>2021 END</p>
<p>贴段baseline-JIT生成的代码 纪念一下</p>
<pre tabindex="0"><code>
def test_1(self) -&gt; None:
    for i in self.user_sparse_features:
        a0 = i * 3
        a1 = i / 3
        a2 = i + 3
        a3 = i - 3


jited func   ┌───────────────────────────────┐
             │                               │
             │prologue                       │
             │                               │
             │                               │
             ├───────────────────────────────┤
┌──yield─────┤start                          │
│            ├───────────────────────────────┤
│            │opcode                         │
│            │                               │
│            │                               │
│            │                               │
│            │                               │
└────────────►opcode                         │
             │                               │
             │                               │
             ├───────────────────────────────┤
             │epilogue                       │
             │                               │
             │                               │
             ├───────────────────────────────┤
             │cold codes                     │
             │                               │
             │                               │
             │                               │
             │                               │
             │                               │
             └───────────────────────────────┘

========================
-------------------
func_prologue
-------------------
0x0000000102e38000  a9bf7ffe		stp x30, xzr, [sp, #-16]!
0x0000000102e38004  a9bf4ff4		stp x20, x19, [sp, #-16]!
0x0000000102e38008  a9bf57f6		stp x22, x21, [sp, #-16]!
0x0000000102e3800c  a9bf5ff8		stp x24, x23, [sp, #-16]!
0x0000000102e38010  a9bf67fa		stp x26, x25, [sp, #-16]!
0x0000000102e38014  a9bf6ffc		stp x28, x27, [sp, #-16]!
0x0000000102e38018  aa0003f3		mov x19, x0
0x0000000102e3801c  aa0103f4		mov x20, x1
0x0000000102e38020  aa0203f5		mov x21, x2
0x0000000102e38024  aa0303f6		mov x22, x3
0x0000000102e38028  aa0403f9		mov x25, x4
0x0000000102e3802c  f940083c		ldr x28, [x1, #16]
0x0000000102e38030  f9400e8a		ldr x10, [x20, #24]
0x0000000102e38034  cb2a63ff		sub sp, sp, x10
-------------------
func_start
-------------------
0x0000000102e38038  d61f00a0		br x5
-------------------
opcode: 124 LOAD_FAST
-------------------
0x0000000102e3803c  d2800010		mov x16, #0x0
0x0000000102e38040  b9006270		str w16, [x19, #96]
-------------------
opcode: 106 LOAD_ATTR
-------------------
0x0000000102e38044  d2800030		mov x16, #0x1
0x0000000102e38048  b9006270		str w16, [x19, #96]
0x0000000102e3804c  f940b27b		ldr x27, [x19, #352]
0x0000000102e38050  f940036a		ldr x10, [x27]
0x0000000102e38054  9100054a		add x10, x10, #0x1 (1)
0x0000000102e38058  f900036a		str x10, [x27]
0x0000000102e3805c  aa1b03e0		mov x0, x27
0x0000000102e38060  d29d8801		mov x1, #0xec40
0x0000000102e38064  f2ae5dc1		movk x1, #0x72ee, lsl #16
0x0000000102e38068  f2c085e1		movk x1, #0x42f, lsl #32
0x0000000102e3806c  d28e4402		mov x2, #0x7220
0x0000000102e38070  f2ae59e2		movk x2, #0x72cf, lsl #16
0x0000000102e38074  f2c085e2		movk x2, #0x42f, lsl #32
0x0000000102e38078  d29d1610		mov x16, #0xe8b0
0x0000000102e3807c  f2a04c50		movk x16, #0x262, lsl #16
0x0000000102e38080  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e38084  d63f0200		blr x16
0x0000000102e38088  aa0003f8		mov x24, x0
0x0000000102e3808c  aa1803fa		mov x26, x24
0x0000000102e38090  f9400370		ldr x16, [x27]
0x0000000102e38094  d1000610		sub x16, x16, #0x1 (1)
0x0000000102e38098  f9000370		str x16, [x27]
0x0000000102e3809c  f100021f		cmp x16, #0x0 (0)
0x0000000102e380a0  540027a0		b.eq #+0x4f4 (addr 0x102e38594)
0x0000000102e380a4  f100031f		cmp x24, #0x0 (0)
0x0000000102e380a8  54000040		b.eq #+0x8 (addr 0x102e380b0)
0x0000000102e380ac  14000002		b #+0x8 (addr 0x102e380b4)
0x0000000102e380b0  14000145		b #+0x514 (addr 0x102e385c4)
-------------------
opcode: 68 GET_ITER
-------------------
0x0000000102e380b4  d2800050		mov x16, #0x2
0x0000000102e380b8  b9006270		str w16, [x19, #96]
0x0000000102e380bc  aa1a03e0		mov x0, x26
0x0000000102e380c0  aa0003fb		mov x27, x0
0x0000000102e380c4  d292ea10		mov x16, #0x9750
0x0000000102e380c8  f2a04a50		movk x16, #0x252, lsl #16
0x0000000102e380cc  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e380d0  d63f0200		blr x16
0x0000000102e380d4  aa0003f8		mov x24, x0
0x0000000102e380d8  f9400370		ldr x16, [x27]
0x0000000102e380dc  d1000610		sub x16, x16, #0x1 (1)
0x0000000102e380e0  f9000370		str x16, [x27]
0x0000000102e380e4  f100021f		cmp x16, #0x0 (0)
0x0000000102e380e8  54002620		b.eq #+0x4c4 (addr 0x102e385ac)
0x0000000102e380ec  f90013fa		str x26, [sp, #32]
0x0000000102e380f0  aa1803fa		mov x26, x24
0x0000000102e380f4  f100031f		cmp x24, #0x0 (0)
0x0000000102e380f8  54000040		b.eq #+0x8 (addr 0x102e38100)
0x0000000102e380fc  14000002		b #+0x8 (addr 0x102e38104)
0x0000000102e38100  14000131		b #+0x4c4 (addr 0x102e385c4)
0x0000000102e38104  f900039a		str x26, [x28]
0x0000000102e38108  d280001a		mov x26, #0x0
0x0000000102e3810c  9100239c		add x28, x28, #0x8 (8)
-------------------
opcode: 93 FOR_ITER
-------------------
0x0000000102e38110  d2800070		mov x16, #0x3
0x0000000102e38114  b9006270		str w16, [x19, #96]
0x0000000102e38118  f85f8380		ldur x0, [x28, #-8]
0x0000000102e3811c  aa0003f8		mov x24, x0
0x0000000102e38120  f9400408		ldr x8, [x0, #8]
0x0000000102e38124  f9407108		ldr x8, [x8, #224]
0x0000000102e38128  d63f0100		blr x8
0x0000000102e3812c  b4001840		cbz x0, #+0x308 (addr 0x102e38434)
0x0000000102e38130  f9000380		str x0, [x28]
0x0000000102e38134  9100239c		add x28, x28, #0x8 (8)
-------------------
opcode: 125 STORE_FAST
-------------------
0x0000000102e38138  d2800090		mov x16, #0x4
0x0000000102e3813c  b9006270		str w16, [x19, #96]
0x0000000102e38140  f85f8388		ldur x8, [x28, #-8]
0x0000000102e38144  d100239c		sub x28, x28, #0x8 (8)
0x0000000102e38148  f940b669		ldr x9, [x19, #360]
0x0000000102e3814c  f900b668		str x8, [x19, #360]
0x0000000102e38150  b40000c9		cbz x9, #+0x18 (addr 0x102e38168)
0x0000000102e38154  f940012a		ldr x10, [x9]
0x0000000102e38158  d100054a		sub x10, x10, #0x1 (1)
0x0000000102e3815c  f900012a		str x10, [x9]
0x0000000102e38160  f100015f		cmp x10, #0x0 (0)
0x0000000102e38164  540018c0		b.eq #+0x318 (addr 0x102e3847c)
-------------------
opcode: 124 LOAD_FAST
-------------------
0x0000000102e38168  d28000b0		mov x16, #0x5
0x0000000102e3816c  b9006270		str w16, [x19, #96]
-------------------
opcode: 100 LOAD_CONST
-------------------
0x0000000102e38170  d28000d0		mov x16, #0x6
0x0000000102e38174  b9006270		str w16, [x19, #96]
-------------------
opcode: 20 BINARY_MULTIPLY
-------------------
0x0000000102e38178  d28000f0		mov x16, #0x7
0x0000000102e3817c  b9006270		str w16, [x19, #96]
0x0000000102e38180  d280441b		mov x27, #0x220
0x0000000102e38184  f2ae58bb		movk x27, #0x72c5, lsl #16
0x0000000102e38188  f2c085fb		movk x27, #0x42f, lsl #32
0x0000000102e3818c  f940b678		ldr x24, [x19, #360]
0x0000000102e38190  aa1803e0		mov x0, x24
0x0000000102e38194  aa1b03e1		mov x1, x27
0x0000000102e38198  d28cef90		mov x16, #0x677c
0x0000000102e3819c  f2a04a50		movk x16, #0x252, lsl #16
0x0000000102e381a0  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e381a4  d63f0200		blr x16
0x0000000102e381a8  aa1803e9		mov x9, x24
0x0000000102e381ac  aa0003f8		mov x24, x0
0x0000000102e381b0  aa1803fa		mov x26, x24
0x0000000102e381b4  f100031f		cmp x24, #0x0 (0)
0x0000000102e381b8  54000040		b.eq #+0x8 (addr 0x102e381c0)
0x0000000102e381bc  14000002		b #+0x8 (addr 0x102e381c4)
0x0000000102e381c0  14000101		b #+0x404 (addr 0x102e385c4)
-------------------
opcode: 125 STORE_FAST
-------------------
0x0000000102e381c4  d2800110		mov x16, #0x8
0x0000000102e381c8  b9006270		str w16, [x19, #96]
0x0000000102e381cc  aa1a03e8		mov x8, x26
0x0000000102e381d0  f940ba69		ldr x9, [x19, #368]
0x0000000102e381d4  f900ba68		str x8, [x19, #368]
0x0000000102e381d8  b40000c9		cbz x9, #+0x18 (addr 0x102e381f0)
0x0000000102e381dc  f940012a		ldr x10, [x9]
0x0000000102e381e0  d100054a		sub x10, x10, #0x1 (1)
0x0000000102e381e4  f900012a		str x10, [x9]
0x0000000102e381e8  f100015f		cmp x10, #0x0 (0)
0x0000000102e381ec  54001680		b.eq #+0x2d0 (addr 0x102e384bc)
-------------------
opcode: 124 LOAD_FAST
-------------------
0x0000000102e381f0  d2800130		mov x16, #0x9
0x0000000102e381f4  b9006270		str w16, [x19, #96]
-------------------
opcode: 100 LOAD_CONST
-------------------
0x0000000102e381f8  d2800150		mov x16, #0xa
0x0000000102e381fc  b9006270		str w16, [x19, #96]
-------------------
opcode: 27 BINARY_TRUE_DIVIDE
-------------------
0x0000000102e38200  d2800170		mov x16, #0xb
0x0000000102e38204  b9006270		str w16, [x19, #96]
0x0000000102e38208  d280441b		mov x27, #0x220
0x0000000102e3820c  f2ae58bb		movk x27, #0x72c5, lsl #16
0x0000000102e38210  f2c085fb		movk x27, #0x42f, lsl #32
0x0000000102e38214  f940b678		ldr x24, [x19, #360]
0x0000000102e38218  aa1803e0		mov x0, x24
0x0000000102e3821c  aa1b03e1		mov x1, x27
0x0000000102e38220  d28d8110		mov x16, #0x6c08
0x0000000102e38224  f2a04a50		movk x16, #0x252, lsl #16
0x0000000102e38228  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e3822c  d63f0200		blr x16
0x0000000102e38230  aa1803e9		mov x9, x24
0x0000000102e38234  aa0003f8		mov x24, x0
0x0000000102e38238  aa1803fa		mov x26, x24
0x0000000102e3823c  f100031f		cmp x24, #0x0 (0)
0x0000000102e38240  54000040		b.eq #+0x8 (addr 0x102e38248)
0x0000000102e38244  14000002		b #+0x8 (addr 0x102e3824c)
0x0000000102e38248  140000df		b #+0x37c (addr 0x102e385c4)
-------------------
opcode: 125 STORE_FAST
-------------------
0x0000000102e3824c  d2800190		mov x16, #0xc
0x0000000102e38250  b9006270		str w16, [x19, #96]
0x0000000102e38254  aa1a03e8		mov x8, x26
0x0000000102e38258  f940be69		ldr x9, [x19, #376]
0x0000000102e3825c  f900be68		str x8, [x19, #376]
0x0000000102e38260  b40000c9		cbz x9, #+0x18 (addr 0x102e38278)
0x0000000102e38264  f940012a		ldr x10, [x9]
0x0000000102e38268  d100054a		sub x10, x10, #0x1 (1)
0x0000000102e3826c  f900012a		str x10, [x9]
0x0000000102e38270  f100015f		cmp x10, #0x0 (0)
0x0000000102e38274  54001440		b.eq #+0x288 (addr 0x102e384fc)
-------------------
opcode: 124 LOAD_FAST
-------------------
0x0000000102e38278  d28001b0		mov x16, #0xd
0x0000000102e3827c  b9006270		str w16, [x19, #96]
-------------------
opcode: 100 LOAD_CONST
-------------------
0x0000000102e38280  d28001d0		mov x16, #0xe
0x0000000102e38284  b9006270		str w16, [x19, #96]
-------------------
opcode: 23 BINARY_ADD
-------------------
0x0000000102e38288  d28001f0		mov x16, #0xf
0x0000000102e3828c  b9006270		str w16, [x19, #96]
0x0000000102e38290  d280441b		mov x27, #0x220
0x0000000102e38294  f2ae58bb		movk x27, #0x72c5, lsl #16
0x0000000102e38298  f2c085fb		movk x27, #0x42f, lsl #32
0x0000000102e3829c  f940b678		ldr x24, [x19, #360]
0x0000000102e382a0  aa1803e0		mov x0, x24
0x0000000102e382a4  aa1b03e1		mov x1, x27
0x0000000102e382a8  d28c8810		mov x16, #0x6440
0x0000000102e382ac  f2a04a50		movk x16, #0x252, lsl #16
0x0000000102e382b0  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e382b4  d63f0200		blr x16
0x0000000102e382b8  aa1803e9		mov x9, x24
0x0000000102e382bc  aa0003f8		mov x24, x0
0x0000000102e382c0  aa1803fa		mov x26, x24
0x0000000102e382c4  f100031f		cmp x24, #0x0 (0)
0x0000000102e382c8  54000040		b.eq #+0x8 (addr 0x102e382d0)
0x0000000102e382cc  14000002		b #+0x8 (addr 0x102e382d4)
0x0000000102e382d0  140000bd		b #+0x2f4 (addr 0x102e385c4)
-------------------
opcode: 125 STORE_FAST
-------------------
0x0000000102e382d4  d2800210		mov x16, #0x10
0x0000000102e382d8  b9006270		str w16, [x19, #96]
0x0000000102e382dc  aa1a03e8		mov x8, x26
0x0000000102e382e0  f940c269		ldr x9, [x19, #384]
0x0000000102e382e4  f900c268		str x8, [x19, #384]
0x0000000102e382e8  b40000c9		cbz x9, #+0x18 (addr 0x102e38300)
0x0000000102e382ec  f940012a		ldr x10, [x9]
0x0000000102e382f0  d100054a		sub x10, x10, #0x1 (1)
0x0000000102e382f4  f900012a		str x10, [x9]
0x0000000102e382f8  f100015f		cmp x10, #0x0 (0)
0x0000000102e382fc  54001200		b.eq #+0x240 (addr 0x102e3853c)
-------------------
opcode: 124 LOAD_FAST
-------------------
0x0000000102e38300  d2800230		mov x16, #0x11
0x0000000102e38304  b9006270		str w16, [x19, #96]
-------------------
opcode: 100 LOAD_CONST
-------------------
0x0000000102e38308  d2800250		mov x16, #0x12
0x0000000102e3830c  b9006270		str w16, [x19, #96]
-------------------
opcode: 24 BINARY_SUBTRACT
-------------------
0x0000000102e38310  d2800270		mov x16, #0x13
0x0000000102e38314  b9006270		str w16, [x19, #96]
0x0000000102e38318  d280441b		mov x27, #0x220
0x0000000102e3831c  f2ae58bb		movk x27, #0x72c5, lsl #16
0x0000000102e38320  f2c085fb		movk x27, #0x42f, lsl #32
0x0000000102e38324  f940b678		ldr x24, [x19, #360]
0x0000000102e38328  aa1803e0		mov x0, x24
0x0000000102e3832c  aa1b03e1		mov x1, x27
0x0000000102e38330  d28bb710		mov x16, #0x5db8
0x0000000102e38334  f2a04a50		movk x16, #0x252, lsl #16
0x0000000102e38338  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e3833c  d63f0200		blr x16
0x0000000102e38340  aa1803e9		mov x9, x24
0x0000000102e38344  aa0003f8		mov x24, x0
0x0000000102e38348  aa1803fa		mov x26, x24
0x0000000102e3834c  f100031f		cmp x24, #0x0 (0)
0x0000000102e38350  54000040		b.eq #+0x8 (addr 0x102e38358)
0x0000000102e38354  14000002		b #+0x8 (addr 0x102e3835c)
0x0000000102e38358  1400009b		b #+0x26c (addr 0x102e385c4)
-------------------
opcode: 125 STORE_FAST
-------------------
0x0000000102e3835c  d2800290		mov x16, #0x14
0x0000000102e38360  b9006270		str w16, [x19, #96]
0x0000000102e38364  aa1a03e8		mov x8, x26
0x0000000102e38368  f940c669		ldr x9, [x19, #392]
0x0000000102e3836c  f900c668		str x8, [x19, #392]
0x0000000102e38370  b40000c9		cbz x9, #+0x18 (addr 0x102e38388)
0x0000000102e38374  f940012a		ldr x10, [x9]
0x0000000102e38378  d100054a		sub x10, x10, #0x1 (1)
0x0000000102e3837c  f900012a		str x10, [x9]
0x0000000102e38380  f100015f		cmp x10, #0x0 (0)
0x0000000102e38384  54000fc0		b.eq #+0x1f8 (addr 0x102e3857c)
-------------------
opcode: 113 JUMP_ABSOLUTE
-------------------
0x0000000102e38388  d28002b0		mov x16, #0x15
0x0000000102e3838c  b9006270		str w16, [x19, #96]
0x0000000102e38390  17ffff60		b #-0x280 (addr 0x102e38110)
-------------------
opcode: 100 LOAD_CONST
-------------------
0x0000000102e38394  d28002d0		mov x16, #0x16
0x0000000102e38398  b9006270		str w16, [x19, #96]
-------------------
opcode: 83 RETURN_VALUE
-------------------
0x0000000102e3839c  d28002f0		mov x16, #0x17
0x0000000102e383a0  b9006270		str w16, [x19, #96]
0x0000000102e383a4  d280a408		mov x8, #0x520
0x0000000102e383a8  f2a05168		movk x8, #0x28b, lsl #16
0x0000000102e383ac  f2c00028		movk x8, #0x1, lsl #32
0x0000000102e383b0  f940010a		ldr x10, [x8]
0x0000000102e383b4  9100054a		add x10, x10, #0x1 (1)
0x0000000102e383b8  f900010a		str x10, [x8]
0x0000000102e383bc  f9400298		ldr x24, [x20]
0x0000000102e383c0  f9000308		str x8, [x24]
0x0000000102e383c4  f9000298		str x24, [x20]
0x0000000102e383c8  d2800029		mov x9, #0x1
0x0000000102e383cc  f806c269		stur x9, [x19, #108]
0x0000000102e383d0  d2800009		mov x9, #0x0
0x0000000102e383d4  b9005269		str w9, [x19, #80]
0x0000000102e383d8  d2800060		mov x0, #0x3
0x0000000102e383dc  14000001		b #+0x4 (addr 0x102e383e0)
-------------------
R_EXITING
-------------------
0x0000000102e383e0  d2800000		mov x0, #0x0
-------------------
DROGON_RET
-------------------
0x0000000102e383e4  8b000380		add x0, x28, x0
0x0000000102e383e8  f9400e8a		ldr x10, [x20, #24]
0x0000000102e383ec  8b2a63ff		add sp, sp, x10
-------------------
func_epilogue
-------------------
0x0000000102e383f0  a8c16ffc		ldp x28, x27, [sp], #16
0x0000000102e383f4  a8c167fa		ldp x26, x25, [sp], #16
0x0000000102e383f8  a8c15ff8		ldp x24, x23, [sp], #16
0x0000000102e383fc  a8c157f6		ldp x22, x21, [sp], #16
0x0000000102e38400  a8c14ff4		ldp x20, x19, [sp], #16
0x0000000102e38404  a8c17ffe		ldp x30, xzr, [sp], #16
0x0000000102e38408  d65f03c0		ret
-------------------
load_fast_cold
-------------------
0x0000000102e3840c  d29a5800		mov x0, #0xd2c0
0x0000000102e38410  f2ae5e60		movk x0, #0x72f3, lsl #16
0x0000000102e38414  f2c085e0		movk x0, #0x42f, lsl #32
0x0000000102e38418  52800001		mov w1, #0x0
0x0000000102e3841c  aa1503e2		mov x2, x21
0x0000000102e38420  d29e4510		mov x16, #0xf228
0x0000000102e38424  f2a04c50		movk x16, #0x262, lsl #16
0x0000000102e38428  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e3842c  d63f0200		blr x16
0x0000000102e38430  14000065		b #+0x194 (addr 0x102e385c4)
-------------------
for_iter_cold
-------------------
0x0000000102e38434  f90002dc		str x28, [x22]
0x0000000102e38438  aa1303e0		mov x0, x19
0x0000000102e3843c  aa1503e1		mov x1, x21
0x0000000102e38440  aa1603e2		mov x2, x22
0x0000000102e38444  aa1803e3		mov x3, x24
0x0000000102e38448  d29d9490		mov x16, #0xeca4
0x0000000102e3844c  f2a04c50		movk x16, #0x262, lsl #16
0x0000000102e38450  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e38454  d63f0200		blr x16
0x0000000102e38458  f94002dc		ldr x28, [x22]
0x0000000102e3845c  f100001f		cmp x0, #0x0 (0)
0x0000000102e38460  54000040		b.eq #+0x8 (addr 0x102e38468)
0x0000000102e38464  14000002		b #+0x8 (addr 0x102e3846c)
0x0000000102e38468  14000057		b #+0x15c (addr 0x102e385c4)
0x0000000102e3846c  f100141f		cmp x0, #0x5 (5)
0x0000000102e38470  54000040		b.eq #+0x8 (addr 0x102e38478)
0x0000000102e38474  17ffff31		b #-0x33c (addr 0x102e38138)
0x0000000102e38478  17ffffc7		b #-0xe4 (addr 0x102e38394)
-------------------
py_xdecref_cold
-------------------
0x0000000102e3847c  aa0903e0		mov x0, x9
0x0000000102e38480  d2960590		mov x16, #0xb02c
0x0000000102e38484  f2a04b10		movk x16, #0x258, lsl #16
0x0000000102e38488  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e3848c  d63f0200		blr x16
0x0000000102e38490  17ffff36		b #-0x328 (addr 0x102e38168)
-------------------
load_fast_cold
-------------------
0x0000000102e38494  d29a5800		mov x0, #0xd2c0
0x0000000102e38498  f2ae5e60		movk x0, #0x72f3, lsl #16
0x0000000102e3849c  f2c085e0		movk x0, #0x42f, lsl #32
0x0000000102e384a0  52800021		mov w1, #0x1
0x0000000102e384a4  aa1503e2		mov x2, x21
0x0000000102e384a8  d29e4510		mov x16, #0xf228
0x0000000102e384ac  f2a04c50		movk x16, #0x262, lsl #16
0x0000000102e384b0  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e384b4  d63f0200		blr x16
0x0000000102e384b8  14000043		b #+0x10c (addr 0x102e385c4)
-------------------
py_xdecref_cold
-------------------
0x0000000102e384bc  aa0903e0		mov x0, x9
0x0000000102e384c0  d2960590		mov x16, #0xb02c
0x0000000102e384c4  f2a04b10		movk x16, #0x258, lsl #16
0x0000000102e384c8  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e384cc  d63f0200		blr x16
0x0000000102e384d0  17ffff48		b #-0x2e0 (addr 0x102e381f0)
-------------------
load_fast_cold
-------------------
0x0000000102e384d4  d29a5800		mov x0, #0xd2c0
0x0000000102e384d8  f2ae5e60		movk x0, #0x72f3, lsl #16
0x0000000102e384dc  f2c085e0		movk x0, #0x42f, lsl #32
0x0000000102e384e0  52800021		mov w1, #0x1
0x0000000102e384e4  aa1503e2		mov x2, x21
0x0000000102e384e8  d29e4510		mov x16, #0xf228
0x0000000102e384ec  f2a04c50		movk x16, #0x262, lsl #16
0x0000000102e384f0  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e384f4  d63f0200		blr x16
0x0000000102e384f8  14000033		b #+0xcc (addr 0x102e385c4)
-------------------
py_xdecref_cold
-------------------
0x0000000102e384fc  aa0903e0		mov x0, x9
0x0000000102e38500  d2960590		mov x16, #0xb02c
0x0000000102e38504  f2a04b10		movk x16, #0x258, lsl #16
0x0000000102e38508  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e3850c  d63f0200		blr x16
0x0000000102e38510  17ffff5a		b #-0x298 (addr 0x102e38278)
-------------------
load_fast_cold
-------------------
0x0000000102e38514  d29a5800		mov x0, #0xd2c0
0x0000000102e38518  f2ae5e60		movk x0, #0x72f3, lsl #16
0x0000000102e3851c  f2c085e0		movk x0, #0x42f, lsl #32
0x0000000102e38520  52800021		mov w1, #0x1
0x0000000102e38524  aa1503e2		mov x2, x21
0x0000000102e38528  d29e4510		mov x16, #0xf228
0x0000000102e3852c  f2a04c50		movk x16, #0x262, lsl #16
0x0000000102e38530  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e38534  d63f0200		blr x16
0x0000000102e38538  14000023		b #+0x8c (addr 0x102e385c4)
-------------------
py_xdecref_cold
-------------------
0x0000000102e3853c  aa0903e0		mov x0, x9
0x0000000102e38540  d2960590		mov x16, #0xb02c
0x0000000102e38544  f2a04b10		movk x16, #0x258, lsl #16
0x0000000102e38548  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e3854c  d63f0200		blr x16
0x0000000102e38550  17ffff6c		b #-0x250 (addr 0x102e38300)
-------------------
load_fast_cold
-------------------
0x0000000102e38554  d29a5800		mov x0, #0xd2c0
0x0000000102e38558  f2ae5e60		movk x0, #0x72f3, lsl #16
0x0000000102e3855c  f2c085e0		movk x0, #0x42f, lsl #32
0x0000000102e38560  52800021		mov w1, #0x1
0x0000000102e38564  aa1503e2		mov x2, x21
0x0000000102e38568  d29e4510		mov x16, #0xf228
0x0000000102e3856c  f2a04c50		movk x16, #0x262, lsl #16
0x0000000102e38570  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e38574  d63f0200		blr x16
0x0000000102e38578  14000013		b #+0x4c (addr 0x102e385c4)
-------------------
py_xdecref_cold
-------------------
0x0000000102e3857c  aa0903e0		mov x0, x9
0x0000000102e38580  d2960590		mov x16, #0xb02c
0x0000000102e38584  f2a04b10		movk x16, #0x258, lsl #16
0x0000000102e38588  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e3858c  d63f0200		blr x16
0x0000000102e38590  17ffff7e		b #-0x208 (addr 0x102e38388)
-------------------
py_decref_cold
-------------------
0x0000000102e38594  aa1b03e0		mov x0, x27
0x0000000102e38598  d2960590		mov x16, #0xb02c
0x0000000102e3859c  f2a04b10		movk x16, #0x258, lsl #16
0x0000000102e385a0  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e385a4  d63f0200		blr x16
0x0000000102e385a8  17fffebf		b #-0x504 (addr 0x102e380a4)
-------------------
py_decref_cold
-------------------
0x0000000102e385ac  aa1b03e0		mov x0, x27
0x0000000102e385b0  d2960590		mov x16, #0xb02c
0x0000000102e385b4  f2a04b10		movk x16, #0x258, lsl #16
0x0000000102e385b8  f2c00030		movk x16, #0x1, lsl #32
0x0000000102e385bc  d63f0200		blr x16
0x0000000102e385c0  17fffecb		b #-0x4d4 (addr 0x102e380ec)
-------------------
R_ERROR
-------------------
0x0000000102e385c4  d2800000		mov x0, #0x0
0x0000000102e385c8  17ffff87		b #-0x1e4 (addr 0x102e383e4)
-------------------
R_EXCEPTION_UNWIND
-------------------
0x0000000102e385cc  d2800020		mov x0, #0x1
0x0000000102e385d0  17ffff85		b #-0x1ec (addr 0x102e383e4)

========================         
</code></pre><ul class="pa0">
  
   <li class="list di">
     <a href="/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">年度总结</a>
   </li>
  
   <li class="list di">
     <a href="/tags/interpreter/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">interpreter</a>
   </li>
  
   <li class="list di">
     <a href="/tags/optimization/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">optimization</a>
   </li>
  
   <li class="list di">
     <a href="/tags/performance/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">performance</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/post/cpython-arm-jit/">cpython ARM64 baseline-JIT Implementation, 20% speed up</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/python-interpreter-parallell/">Implementation Python Interpreter Parallel in Python 3.10</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/about/">About</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  xiejunyi blog 2023 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
